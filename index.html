<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Crypto Vision - Professional Cryptocurrency Trading Terminal">
    <meta name="author" content="Crypto Vision Labs">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com;
        connect-src 'self' wss://stream.binance.com:9443 https://api.binance.com;
        img-src 'self' data: https:;
        font-src 'self' data:;
        frame-ancestors 'none';
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <title>Crypto Vision - Professional Trading Terminal</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>üíé</text></svg>">
    
    <!-- External Resources with SRI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-primary: #030712;
            --bg-secondary: #111827;
            --border: #1f2937;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #030712 0%, #0f172a 100%);
            color: #f9fafb;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            overflow: hidden;
            position: relative;
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle, rgba(59,130,246,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .terminal-layout {
            display: grid;
            grid-template-columns: 340px 1fr 340px;
            grid-template-rows: 70px 1fr 200px;
            height: 100vh;
            gap: 12px;
            padding: 12px;
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 1400px) {
            .terminal-layout {
                grid-template-columns: 280px 1fr 280px;
            }
        }
        
        @media (max-width: 1024px) {
            .terminal-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                overflow-y: auto;
            }
        }
        
        .panel {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(31, 41, 55, 0.8);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59,130,246,0.3), transparent);
        }
        
        .panel:hover {
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.1);
        }
        
        .panel-header {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            padding: 14px 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #9ca3af;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(55, 65, 81, 0.5);
        }
        
        .font-mono { font-family: 'Courier New', 'Consolas', monospace; }
        
        .live-indicator {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 12px var(--success);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        
        .crypto-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(31, 41, 55, 0.5);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .crypto-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }
        
        .crypto-item:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .crypto-item:hover::before {
            transform: scaleY(1);
        }
        
        .btn {
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            outline: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid rgba(107, 114, 128, 0.5);
            color: #9ca3af;
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .whale-alert {
            padding: 12px;
            border-left: 3px solid var(--warning);
            background: rgba(245, 158, 11, 0.05);
            margin-bottom: 8px;
            border-radius: 4px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .loading-spinner {
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(31, 41, 55, 0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(55, 65, 81, 0.8); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(75, 85, 99, 0.9); }
        
        .tooltip {
            position: absolute;
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(59, 130, 246, 0.5);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 12px;
            border-radius: 8px;
            color: #fca5a5;
            font-size: 12px;
            margin: 10px;
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading-screen" style="position: fixed; inset: 0; background: #030712; display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center;">
            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>
            <div style="font-size: 14px; color: #9ca3af; font-weight: 600;">Initializing Crypto Vision Terminal...</div>
            <div style="font-size: 11px; color: #6b7280; margin-top: 8px;">Connecting to secure nodes</div>
        </div>
    </div>

    <div class="terminal-layout" id="main-terminal" style="opacity: 0;">
        <!-- Header -->
        <header class="col-span-3 panel flex-row items-center justify-between px-8">
            <div class="flex items-center gap-6">
                <h1 style="font-size: 24px; font-weight: 900; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 2px;">
                    üíé CRYPTO VISION
                </h1>
                <div class="flex items-center gap-3 text-[10px] text-gray-500 font-mono">
                    <span class="live-indicator"></span>
                    <span>NETWORK: <span class="text-emerald-400 font-bold">SECURE</span></span>
                    <span>|</span>
                    <span id="clock">00:00:00</span>
                </div>
            </div>
            <div class="flex gap-6 text-[11px] font-mono items-center">
                <span class="text-emerald-400">FEAR & GREED: <span class="font-bold">65</span></span>
                <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full font-bold">SENTIMENT: BULLISH üöÄ</span>
            </div>
        </header>

        <!-- Left Sidebar -->
        <aside class="panel">
            <div class="panel-header">
                <span>üìä Watchlist</span>
                <button class="btn-outline" style="padding: 4px 12px; font-size: 9px;">+ Add</button>
            </div>
            <div id="watchlist" class="flex-1 overflow-y-auto"></div>
            
            <div class="panel-header" style="border-top: 1px solid rgba(55, 65, 81, 0.5);">
                <span>üíº Portfolio</span>
            </div>
            <div class="p-6 bg-gradient-to-br from-blue-900/10 to-transparent">
                <div class="text-[10px] text-gray-500 mb-2 uppercase tracking-wider">Total Value</div>
                <div class="text-3xl font-bold font-mono text-emerald-400" id="portfolio-value">$0.00</div>
                <div class="text-[10px] font-bold mt-2" id="portfolio-change">
                    <span class="text-emerald-500">+0.0%</span>
                    <span class="text-gray-500 ml-2">(24h)</span>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-800">
                    <div class="flex justify-between text-[10px] mb-2">
                        <span class="text-gray-500">Holdings:</span>
                        <span class="text-white font-bold">4 Assets</span>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-gray-500">Best Performer:</span>
                        <span class="text-emerald-400 font-bold">SOL +18.2%</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chart -->
        <main class="panel relative">
            <div class="panel-header">
                <span>üìà BITCOIN / USDT - Real-Time Stream</span>
                <div class="flex gap-2">
                    <button class="btn btn-primary" style="padding: 6px 14px;">LIVE</button>
                    <button class="btn-outline" style="padding: 6px 14px;">1H</button>
                    <button class="btn-outline" style="padding: 6px 14px;">4H</button>
                    <button class="btn-outline" style="padding: 6px 14px;">1D</button>
                </div>
            </div>
            
            <div class="flex-1 p-6 relative">
                <canvas id="mainChart"></canvas>
            </div>
            
            <div class="p-5 bg-gradient-to-r from-gray-900/50 to-transparent border-t border-gray-800">
                <div class="flex justify-between items-center mb-3">
                    <p id="ai-insight" class="text-xs italic text-blue-400 font-mono flex items-center gap-2">
                        <span class="text-blue-500">‚ñ∏</span>
                        <span>AI Analysis: Monitoring market patterns...</span>
                    </p>
                    <div id="signal-indicator" class="text-[10px] px-3 py-1 rounded-full bg-gray-800 text-gray-400">
                        ANALYZING...
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="CryptoVision.setAlert()" class="btn btn-outline flex-1">üîî Set Alert</button>
                    <button onclick="CryptoVision.openTrade()" class="btn btn-success flex-1">‚ö° Quick Trade</button>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="panel">
            <div class="panel-header">
                <span>üêã Whale Tracker</span>
                <span class="text-[9px] text-orange-400">REAL-TIME</span>
            </div>
            <div id="whale-logs" class="flex-1 overflow-y-auto p-3 space-y-2"></div>
            
            <div class="panel-header" style="border-top: 1px solid rgba(55, 65, 81, 0.5);">
                <span>üì∞ Market News</span>
            </div>
            <div id="news-feed" class="p-3 h-40 overflow-y-auto text-[11px] space-y-3"></div>
        </aside>

        <!-- Footer Terminal -->
        <footer class="col-span-3 panel">
            <div class="panel-header">
                <span>‚ö° System Terminal</span>
                <div class="flex gap-2">
                    <button onclick="CryptoVision.clearLogs()" class="text-[9px] text-gray-500 hover:text-white transition">Clear</button>
                </div>
            </div>
            <div id="logs" class="p-4 font-mono text-[10px] text-blue-400/80 overflow-y-auto bg-black/30 h-full leading-relaxed"></div>
        </footer>
    </div>

    <script>
        'use strict';
        
        // ===========================
        // CRYPTO VISION CORE ENGINE
        // ===========================
        
        const CryptoVision = (() => {
            
            // Security Configuration
            const SECURITY = {
                maxReconnectAttempts: 5,
                reconnectDelay: 3000,
                requestTimeout: 15000,
                rateLimitWindow: 60000,
                maxRequestsPerWindow: 100
            };
            
            // Application State
            const STATE = {
                isConnected: false,
                reconnectAttempts: 0,
                lastUpdate: null,
                priceHistory: {},
                alerts: [],
                requestCount: 0,
                lastRateLimitReset: Date.now()
            };
            
            // Asset Configuration
            const ASSETS = [
                { id: 'btcusdt', name: 'Bitcoin', symbol: 'BTC', allocation: 0.4 },
                { id: 'ethusdt', name: 'Ethereum', symbol: 'ETH', allocation: 0.3 },
                { id: 'solusdt', name: 'Solana', symbol: 'SOL', allocation: 0.2 },
                { id: 'bnbusdt', name: 'BNB', symbol: 'BNB', allocation: 0.1 }
            ];
            
            let chart = null;
            let ws = null;
            let portfolioValue = 24180.50;
            
            // ===========================
            // UTILITY FUNCTIONS
            // ===========================
            
            const Utils = {
                sanitize: (str) => {
                    const div = document.createElement('div');
                    div.textContent = str;
                    return div.innerHTML;
                },
                
                formatNumber: (num, decimals = 2) => {
                    return new Intl.NumberFormat('en-US', {
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    }).format(num);
                },
                
                formatCurrency: (num) => {
                    return '$' + Utils.formatNumber(num, 2);
                },
                
                getTimestamp: () => {
                    return new Date().toLocaleTimeString('en-US', { hour12: false });
                },
                
                checkRateLimit: () => {
                    const now = Date.now();
                    if (now - STATE.lastRateLimitReset > SECURITY.rateLimitWindow) {
                        STATE.requestCount = 0;
                        STATE.lastRateLimitReset = now;
                    }
                    
                    if (STATE.requestCount >= SECURITY.maxRequestsPerWindow) {
                        Logger.warn('Rate limit exceeded');
                        return false;
                    }
                    
                    STATE.requestCount++;
                    return true;
                },
                
                validatePrice: (price) => {
                    return typeof price === 'number' && !isNaN(price) && price > 0;
                }
            };
            
            // ===========================
            // LOGGER SYSTEM
            // ===========================
            
            const Logger = {
                log: (message, type = 'info') => {
                    const logsEl = document.getElementById('logs');
                    if (!logsEl) return;
                    
                    const colors = {
                        info: '#60a5fa',
                        success: '#34d399',
                        warning: '#fbbf24',
                        error: '#f87171'
                    };
                    
                    const timestamp = Utils.getTimestamp();
                    const sanitized = Utils.sanitize(message);
                    
                    logsEl.innerHTML += `<div style="color: ${colors[type]};">[${timestamp}] ${sanitized}</div>`;
                    logsEl.scrollTop = logsEl.scrollHeight;
                    
                    // Keep last 100 entries
                    const lines = logsEl.children;
                    while (lines.length > 100) {
                        logsEl.removeChild(lines[0]);
                    }
                },
                
                info: (msg) => Logger.log(msg, 'info'),
                success: (msg) => Logger.log(msg, 'success'),
                warn: (msg) => Logger.log(msg, 'warning'),
                error: (msg) => Logger.log(msg, 'error')
            };
            
            // ===========================
            // CHART INITIALIZATION
            // ===========================
            
            const ChartManager = {
                init: () => {
                    const ctx = document.getElementById('mainChart');
                    if (!ctx) return;
                    
                    chart = new Chart(ctx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: Array(50).fill(''),
                            datasets: [{
                                data: Array(50).fill(null),
                                borderColor: '#3b82f6',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: true,
                                backgroundColor: (context) => {
                                    const ctx = context.chart.ctx;
                                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                                    gradient.addColorStop(0, 'rgba(59, 130, 246, 0.2)');
                                    gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
                                    return gradient;
                                },
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            scales: {
                                x: {
                                    display: false
                                },
                                y: {
                                    grid: {
                                        color: 'rgba(31, 41, 55, 0.5)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: '#6b7280',
                                        font: { size: 10, family: 'monospace' },
                                        callback: (value) => '$' + Utils.formatNumber(value, 0)
                                    }
                                }
                            },
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                    titleColor: '#3b82f6',
                                    bodyColor: '#f9fafb',
                                    borderColor: '#3b82f6',
                                    borderWidth: 1,
                                    padding: 12,
                                    displayColors: false,
                                    callbacks: {
                                        label: (context) => 'Price: $' + Utils.formatNumber(context.parsed.y, 2)
                                    }
                                }
                            }
                        }
                    });
                    
                    Logger.success('Chart initialized successfully');
                },
                
                update: (price) => {
                    if (!chart || !Utils.validatePrice(price)) return;
                    
                    chart.data.datasets[0].data.shift();
                    chart.data.datasets[0].data.push(price);
                    chart.update('none');
                }
            };
            
            // ===========================
            // WEBSOCKET MANAGER
            // ===========================
            
            const WebSocketManager = {
                connect: () => {
                    if (!Utils.checkRateLimit()) {
                        setTimeout(() => WebSocketManager.connect(), SECURITY.reconnectDelay);
                        return;
                    }
                    
                    try {
                        const streams = ASSETS.map(a => `${a.id}@ticker`).join('/');
                        ws = new WebSocket(`wss://stream.binance.com:9443/ws/${streams}`);
                        
                        ws.onopen = () => {
                            STATE.isConnected = true;
                            STATE.reconnectAttempts = 0;
                            Logger.success('WebSocket connected to Binance stream');
                        };
                        
                        ws.onmessage = (event) => {
                            try {
                                const data = JSON.parse(event.data);
                                WebSocketManager.handleMessage(data);
                            } catch (error) {
                                Logger.error('Failed to parse WebSocket message');
                            }
                        };
                        
                        ws.onerror = (error) => {
                            Logger.error('WebSocket connection error');
                            STATE.isConnected = false;
                        };
                        
                        ws.onclose = () => {
                            STATE.isConnected = false;
                            Logger.warn('WebSocket connection closed');
                            WebSocketManager.reconnect();
                        };
                        
                    } catch (error) {
                        Logger.error('Failed to initialize WebSocket');
                        WebSocketManager.reconnect();
                    }
                },
                
                handleMessage: (data) => {
                    const id = data.s.toLowerCase();
                    const price = parseFloat(data.c);
                    const change = parseFloat(data.P);
                    
                    if (!Utils.validatePrice(price)) {
                        Logger.warn(`Invalid price received for ${id}`);
                        return;
                    }
                    
                    // Update price display
                    const priceEl = document.getElementById(`price-${id}`);
                    const changeEl = document.getElementById(`change-${id}`);
                    
                    if (priceEl && changeEl) {
                        priceEl.textContent = Utils.formatCurrency(price);
                        changeEl.textContent = `${change >= 0 ? '+' : ''}${Utils.formatNumber(change, 2)}%`;
                        changeEl.className = change >= 0 ? 'text-emerald-500 font-bold' : 'text-red-500 font-bold';
                    }
                    
                    // Update chart for BTC
                    if (id === 'btcusdt') {
                        ChartManager.update(price);
                        AIEngine.analyze(price);
                    }
                    
                    // Store price history
                    if (!STATE.priceHistory[id]) STATE.priceHistory[id] = [];
                    STATE.priceHistory[id].push({ price, timestamp: Date.now() });
                    if (STATE.priceHistory[id].length > 100) {
                        STATE.priceHistory[id].shift();
                    }
                    
                    // Update portfolio
                    PortfolioManager.update();
                    
                    // Check alerts
                    AlertManager.check(id, price);
                    
                    STATE.lastUpdate = Date.now();
                },
                
                reconnect: () => {
                    if (STATE.reconnectAttempts >= SECURITY.maxReconnectAttempts) {
                        Logger.error('Max reconnection attempts reached');
                        UI.showError('Connection lost. Please refresh the page.');
                        return;
                    }
                    
                    STATE.reconnectAttempts++;
                    Logger.info(`Reconnecting... (Attempt ${STATE.reconnectAttempts}/${SECURITY.maxReconnectAttempts})`);
                    
                    setTimeout(() => {
                        WebSocketManager.connect();
                    }, SECURITY.reconnectDelay * STATE.reconnectAttempts);
                },
                
                disconnect: () => {
                    if (ws) {
                        ws.close();
                        ws = null;
                        STATE.isConnected = false;
                        Logger.info('WebSocket disconnected');
                    }
                }
            };
            
            // ===========================
            // PORTFOLIO MANAGER
            // ===========================
            
            const PortfolioManager = {
                update: () => {
                    let totalValue = 0;
                    let totalChange = 0;
                    
                    ASSETS.forEach(asset => {
                        const history = STATE.priceHistory[asset.id];
                        if (history && history.length > 1) {
                            const current = history[history.length - 1].price;
                            const previous = history[0].price;
                            const change = ((current - previous) / previous) * 100;
                            
                            const assetValue = portfolioValue * asset.allocation;
                            totalValue += assetValue * (1 + change / 100);
                            totalChange += change * asset.allocation;
                        }
                    });
                    
                    const valueEl = document.getElementById('portfolio-value');
                    const changeEl = document.getElementById('portfolio-change');
                    
                    if (valueEl && changeEl) {
                        valueEl.textContent = Utils.formatCurrency(totalValue || portfolioValue);
                        
                        const changePercent = Utils.formatNumber(totalChange, 2);
                        const changeClass = totalChange >= 0 ? 'text-emerald-500' : 'text-red-500';
                        changeEl.innerHTML = `
                            <span class="${changeClass}">${totalChange >= 0 ? '+' : ''}${changePercent}%</span>
                            <span class="text-gray-500 ml-2">(24h)</span>
                        `;
                    }
                }
            };
            
            // ===========================
            // AI ENGINE
            // ===========================
            
            const AIEngine = {
                lastAnalysis: 0,
                
                analyze: (price) => {
                    const now = Date.now();
                    if (now - AIEngine.lastAnalysis < 10000) return;
                    
                    AIEngine.lastAnalysis = now;
                    
                    const insights = [
                        'Detecting strong accumulation patterns in current timeframe',
                        'Volume analysis suggests bullish momentum building',
                        'RSI indicators showing potential reversal zone',
                        'Price action forming higher lows - bullish structure',
                        'Whale activity detected - monitoring large transactions',
                        'Support level holding strong at current price range',
                        'Market sentiment shifting towards risk-on positioning'
                    ];
                    
                    const signals = ['BULLISH', 'NEUTRAL', 'BEARISH'];
                    const colors = {
                        'BULLISH': 'bg-emerald-500/20 text-emerald-400',
                        'NEUTRAL': 'bg-yellow-500/20 text-yellow-400',
                        'BEARISH': 'bg-red-500/20 text-red-400'
                    };
                    
                    const signal = signals[Math.floor(Math.random() * signals.length)];
                    const insight = insights[Math.floor(Math.random() * insights.length)];
                    
                    const insightEl = document.getElementById('ai-insight');
                    const signalEl = document.getElementById('signal-indicator');
                    
                    if (insightEl) {
                        insightEl.innerHTML = `
                            <span class="text-blue-500">‚ñ∏</span>
                            <span>${Utils.sanitize(insight)}</span>
                        `;
                    }
                    
                    if (signalEl) {
                        signalEl.textContent = signal;
                        signalEl.className = `text-[10px] px-3 py-1 rounded-full ${colors[signal]} font-bold`;
                    }
                }
            };
            
            // ===========================
            // ALERT MANAGER
            // ===========================
            
            const AlertManager = {
                check: (assetId, price) => {
                    STATE.alerts.forEach((alert, index) => {
                        if (alert.assetId === assetId) {
                            const triggered = alert.type === 'above' ? price >= alert.price : price <= alert.price;
                            
                            if (triggered) {
                                AlertManager.trigger(alert);
                                STATE.alerts.splice(index, 1);
                            }
                        }
                    });
                },
                
                trigger: (alert) => {
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('üîî Crypto Vision Alert', {
                            body: `${alert.assetId.toUpperCase()} reached $${Utils.formatNumber(alert.price)}`,
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">üíé</text></svg>'
                        });
                    }
                    
                    Logger.success(`Alert triggered: ${alert.assetId.toUpperCase()} @ $${Utils.formatNumber(alert.price)}`);
                }
            };
            
            // ===========================
            // SIMULATION ENGINES
            // ===========================
            
            const SimulationEngine = {
                whaleActivity: () => {
                    const whaleEl = document.getElementById('whale-logs');
                    if (!whaleEl) return;
                    
                    const asset = ASSETS[Math.floor(Math.random() * ASSETS.length)];
                    const amount = Math.floor(Math.random() * 1000 + 100);
                    const actions = ['moved to Exchange', 'transferred to Cold Wallet', 'split across wallets', 'deposited to DeFi protocol'];
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    
                    const alert = document.createElement('div');
                    alert.className = 'whale-alert font-mono text-[10px]';
                    alert.innerHTML = `
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-orange-400 font-bold">üêã WHALE ALERT</span>
                            <span class="text-gray-500">${Utils.getTimestamp()}</span>
                        </div>
                        <div class="text-gray-300">
                            ${Utils.formatNumber(amount, 0)} ${asset.symbol} ${Utils.sanitize(action)}
                        </div>
                    `;
                    
                    whaleEl.insertBefore(alert, whaleEl.firstChild);
                    
                    while (whaleEl.children.length > 20) {
                        whaleEl.removeChild(whaleEl.lastChild);
                    }
                    
                    Logger.info(`Whale activity: ${amount} ${asset.symbol} ${action}`);
                },
                
                newsStream: () => {
                    const newsEl = document.getElementById('news-feed');
                    if (!newsEl) return;
                    
                    const headlines = [
                        'BlackRock files for additional crypto ETF products',
                        'Major exchange announces enhanced security features',
                        'Institutional adoption reaches new quarterly high',
                        'Regulatory clarity improves in key markets',
                        'DeFi protocol launches innovative yield strategy',
                        'Layer-2 solution achieves record transaction throughput',
                        'Central bank explores blockchain integration',
                        'Crypto payment adoption grows among merchants'
                    ];
                    
                    const headline = headlines[Math.floor(Math.random() * headlines.length)];
                    
                    const newsItem = document.createElement('div');
                    newsItem.className = 'border-l-2 border-blue-500/30 pl-3 py-1';
                    newsItem.innerHTML = `
                        <div class="text-blue-400 font-semibold mb-1">üì∞ ${Utils.sanitize(headline)}</div>
                        <div class="text-gray-600 text-[9px]">${Utils.getTimestamp()} ‚Ä¢ Market News</div>
                    `;
                    
                    newsEl.insertBefore(newsItem, newsEl.firstChild);
                    
                    while (newsEl.children.length > 5) {
                        newsEl.removeChild(newsEl.lastChild);
                    }
                }
            };
            
            // ===========================
            // UI MANAGER
            // ===========================
            
            const UI = {
                init: () => {
                    const watchlist = document.getElementById('watchlist');
                    if (!watchlist) return;
                    
                    ASSETS.forEach(asset => {
                        const item = document.createElement('div');
                        item.className = 'crypto-item';
                        item.innerHTML = `
                            <div class="flex justify-between items-center mb-2">
                                <div>
                                    <div class="text-sm font-bold text-white">${Utils.sanitize(asset.name)}</div>
                                    <div class="text-[10px] text-gray-500 uppercase tracking-wider">${asset.symbol} / USDT</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-mono text-emerald-400 font-bold" id="price-${asset.id}">$0.00</div>
                                    <div class="text-[10px] font-mono font-bold" id="change-${asset.id}">0.00%</div>
                                </div>
                            </div>
                        `;
                        watchlist.appendChild(item);
                    });
                    
                    Logger.success('Watchlist initialized');
                },
                
                updateClock: () => {
                    const clockEl = document.getElementById('clock');
                    if (clockEl) {
                        clockEl.textContent = Utils.getTimestamp();
                    }
                },
                
                showError: (message) => {
                    const terminal = document.getElementById('main-terminal');
                    if (!terminal) return;
                    
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-message';
                    errorDiv.textContent = message;
                    
                    terminal.insertBefore(errorDiv, terminal.firstChild);
                    
                    setTimeout(() => errorDiv.remove(), 10000);
                },
                
                hideLoading: () => {
                    const loading = document.getElementById('loading-screen');
                    const terminal = document.getElementById('main-terminal');
                    
                    setTimeout(() => {
                        if (loading) {
                            loading.style.opacity = '0';
                            setTimeout(() => loading.remove(), 300);
                        }
                        if (terminal) {
                            terminal.style.opacity = '1';
                            terminal.style.transition = 'opacity 0.5s ease';
                        }
                    }, 1500);
                }
            };
            
            // ===========================
            // PUBLIC API
            // ===========================
            
            return {
                init: () => {
                    Logger.info('Initializing Crypto Vision Terminal v5.0...');
                    Logger.info('Security protocols: ACTIVE');
                    Logger.info('Encryption: TLS 1.3');
                    
                    // Request notification permission
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission();
                    }
                    
                    UI.init();
                    ChartManager.init();
                    WebSocketManager.connect();
                    
                    // Start simulations
                    setInterval(() => SimulationEngine.whaleActivity(), 8000);
                    setInterval(() => SimulationEngine.newsStream(), 20000);
                    setInterval(() => UI.updateClock(), 1000);
                    
                    // Hide loading screen
                    UI.hideLoading();
                    
                    Logger.success('System ready. All modules operational.');
                },
                
                setAlert: () => {
                    const price = prompt('Enter target price for BTC/USDT:');
                    if (price && !isNaN(price) && price > 0) {
                        STATE.alerts.push({
                            assetId: 'btcusdt',
                            price: parseFloat(price),
                            type: 'above'
                        });
                        Logger.success(`Alert set for BTC @ $${Utils.formatNumber(parseFloat(price))}`);
                    }
                },
                
                openTrade: () => {
                    Logger.info('Opening trade interface...');
                    alert('üöÄ Trade module will be available in the next update!\nStay tuned for Crypto Vision Pro features.');
                },
                
                clearLogs: () => {
                    const logsEl = document.getElementById('logs');
                    if (logsEl) {
                        logsEl.innerHTML = '';
                        Logger.info('Logs cleared');
                    }
                },
                
                destroy: () => {
                    WebSocketManager.disconnect();
                    if (chart) chart.destroy();
                    Logger.info('System shutdown complete');
                }
            };
        })();
        
        // ===========================
        // APPLICATION BOOTSTRAP
        // ===========================
        
        document.addEventListener('DOMContentLoaded', () => {
            CryptoVision.init();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            CryptoVision.destroy();
        });
        
        // Prevent context menu (optional security measure)
        // document.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>

</body>
</html>